<UserControl x:Class="ElectronicObserver.Window.Wpf.Fleet.FleetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:views="clr-namespace:ElectronicObserver.Window.Wpf.Fleet.Views"
             xmlns:viewModels="clr-namespace:ElectronicObserver.Window.Wpf.Fleet.ViewModels"

             x:Name="FleetControl"

             mc:Ignorable="d" 
             d:DesignHeight="150" d:DesignWidth="200">
	<UserControl.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="../Resources.xaml" />
			</ResourceDictionary.MergedDictionaries>

			<Storyboard 
				x:Key="Taiha"
				Storyboard.TargetProperty="Background.(SolidColorBrush.Color)"
				Duration="0:0:2"
				RepeatBehavior="Forever"
			>
				<ColorAnimationUsingKeyFrames>
					<DiscreteColorKeyFrame KeyTime="0:0:0" Value="Transparent"/>
				</ColorAnimationUsingKeyFrames>
				<ColorAnimationUsingKeyFrames>
					<DiscreteColorKeyFrame KeyTime="0:0:1" Value="Red"/>
				</ColorAnimationUsingKeyFrames>
				<ColorAnimationUsingKeyFrames>
					<DiscreteColorKeyFrame KeyTime="0:0:2" Value="Transparent"/>
				</ColorAnimationUsingKeyFrames>
			</Storyboard>


		</ResourceDictionary>
	</UserControl.Resources>

	<Grid DataContext="{Binding ViewModel, ElementName=FleetControl}" IsSharedSizeScope="True" Visibility="{Binding FleetVisibility}">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition />
		</Grid.RowDefinitions>

		<Border Grid.Row="0">
			<Border.Style>
				<Style TargetType="Border">
					<Setter Property="Background" Value="Transparent" />
					<Style.Triggers>
						<DataTrigger Binding="{Binding HasTaihaShip}" Value="True">
							<DataTrigger.EnterActions>
								<BeginStoryboard x:Name="TaihaStoryboard" Storyboard="{StaticResource Taiha}" />
							</DataTrigger.EnterActions>
						</DataTrigger>
						<DataTrigger Binding="{Binding HasTaihaShip}" Value="False">
							<DataTrigger.EnterActions>
								<StopStoryboard BeginStoryboardName="TaihaStoryboard" />
							</DataTrigger.EnterActions>
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</Border.Style>
			<Border.ContextMenu>
				<ContextMenu>
					<MenuItem Header="Copy" Command="{Binding CopyCommand}" />
					<MenuItem Header="Copy (deck-builder)" Command="{Binding CopyDeckBuilderCommand}" />
					<MenuItem Header="Copy Ship List (kancolle-calc)" Command="{Binding CopyKanmusuListCommand}" />
					<MenuItem Header="Copy Ship List (kancolle-fleetanalysis)" Command="{Binding CopyFleetAnalysisCommand}" />
					<MenuItem Header="Copy Locked Equip (kancolle-fleetanalysis)" Command="{Binding CopyFleetAnalysisEquipCommand}" />
					<MenuItem Header="Copy All Equip (kancolle-fleetanalysis)" Command="{Binding CopyFleetAnalysisAllEquipCommand}" />
					<Separator />
					<MenuItem Header="AA Defense" Command="{Binding AntiAirDetailsCommand}" />
					<MenuItem Header="Copy as Image" />
					<MenuItem Header="Save as Image..." Command="{Binding OutputFleetImageCommand}" />
				</ContextMenu>
			</Border.ContextMenu>
			<StackPanel Orientation="Horizontal">
				<TextBlock Margin="4 2" Text="{Binding Name}" ToolTip="{Binding FleetNameToolTip}"/>
				<StackPanel Margin="4 2" Orientation="Horizontal" ToolTip="{Binding FleetStatusToolTip}">
					<Image Margin="2 0" Source="{Binding FleetStatusImage}" />
					<TextBlock Text="{Binding FleetStatusText}" />
				</StackPanel>
				<StackPanel Margin="4 2" Orientation="Horizontal" ToolTip="{Binding FleetAirToolTip}">
					<Image Margin="2 0" Source="{Binding AirImage}" />
					<TextBlock Text="{Binding AirString}" />
				</StackPanel>
				<Border Margin="4 2" ToolTip="{Binding FleetLosToolTip}" Background="Transparent">
					<Border.InputBindings>
						<MouseBinding Command="{Binding IncreaseBranchWeightCommand}" MouseAction="LeftClick" />
					</Border.InputBindings>
					<StackPanel Orientation="Horizontal">
						<Image Margin="2 0" Source="{Binding LosImage}" />
						<TextBlock Text="{Binding LosString}" />
					</StackPanel>
				</Border>
				<StackPanel Margin="4 2" Orientation="Horizontal" ToolTip="{Binding FleetAaToolTip}">
					<Image Margin="2 0" Source="{Binding FleetAaImage}" />
					<TextBlock Text="{Binding FleetAaString}" />
				</StackPanel>
			</StackPanel>
		</Border>

		<ItemsControl Grid.Row="1" ItemsSource="{Binding Ships}">
			<ItemsControl.ItemsPanel>
				<ItemsPanelTemplate>
					<StackPanel Orientation="Vertical"/>
				</ItemsPanelTemplate>
			</ItemsControl.ItemsPanel>
			<ItemsControl.ItemTemplate>
				<DataTemplate DataType="viewModels:ShipViewModel">
					<views:ShipView ViewModel="{Binding}" />
				</DataTemplate>
			</ItemsControl.ItemTemplate>
		</ItemsControl>
	</Grid>
</UserControl>
